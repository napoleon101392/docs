<!DOCTYPE html>
<html>
  <head>
    <title>Controller - Solid Layer Documentation</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../.docs-compiled/assets/css/font-awesome.css">
    <link rel="stylesheet" href="../.docs-compiled/assets/css/slayer.css">
  </head>
  <body>
    <nav class="navbar">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="#">S.layer</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="nav-link active-slayer"><a href="#">Documentation</a></li>
                <li class="nav-link"><a href="#">Forum</a></li>
                <li>
                    <form class="navbar-form navbar-left">
                        <div class="form-group has-feedback">
                            <input type="text" class="form-control" placeholder="Search">
                            <i class="glyphicon glyphicon-search form-control-feedback"></i>
                        </div>
                    </form>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>    <div class="container">
      <div class="row">
        <div class="col-md-3 version">
          <div class="btn-group">
  <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    v1.4.0 <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="#">v1.4.1</a></li>
    <li><a href="#">v1.4.2</a></li>
    <li><a href="#">v1.4.3</a></li>
    <li><a href="#">v1.4.4</a></li>
  </ul>
</div>
        </div>
        <div class="col-md-9">
            <h1>Controller</h1>
        </div>
      </div>
      <div class="row">
        <div class="sidebar col-md-3">
            <ul class="sidebar-level-1"><li class="menu-level-1"><div class="nav-menu-title">Prologue</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="prologue-change-log.html">Change Log</a></li><li class="menu-level-2"><a href="prologue-contribution-guide.html">Contribution Guide</a></li></ul></li><li class="menu-level-1"><div class="nav-menu-title">Setup</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="index.html">Installation</a></li><li class="menu-level-2"><a href="setup-configuration.html">Configuration</a></li></ul></li><li class="menu-level-1"><div class="nav-menu-title">Modular-MVC</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="modular-mvc-module.html">Module</a></li><li class="menu-level-2"><a href="modular-mvc-controller.html">Controller</a></li><li class="menu-level-2"><a href="modular-mvc-view.html">View</a></li><li class="menu-level-2"><a href="modular-mvc-model.html">Model</a></li></ul></li><li class="menu-level-1"><div class="nav-menu-title">Supporting Structure</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="supporting-structure-error-handler.html">Error Handler</a></li><li class="menu-level-2"><a href="supporting-structure-routing.html">Routing</a></li><li class="menu-level-2"><a href="supporting-structure-sandbox.html">Sandbox</a></li><li class="menu-level-2"><a href="supporting-structure-service-provider.html">Service Provider</a></li><li class="menu-level-2"><a href="supporting-structure-storage.html">Storage</a></li><li class="menu-level-2"><a href="supporting-structure-unit-testing.html">Unit Testing</a></li><li class="menu-level-2"><a href="supporting-structure-validation.html">Validation</a></li></ul></li><li class="menu-level-1"><div class="nav-menu-title">Services</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="services-aliases.html">Aliases</a></li><li class="menu-level-2"><a href="services-auth.html">Auth</a></li><li class="menu-level-2"><a href="services-cache.html">Cache</a></li><li class="menu-level-2"><a href="services-db.html">DB</a></li><li class="menu-level-2"><a href="services-dispatcher.html">Dispatcher</a></li><li class="menu-level-2"><a href="services-filter.html">Filter</a></li><li class="menu-level-2"><a href="services-flash.html">Flash</a></li><li class="menu-level-2"><a href="services-flashbag.html">FlashBag</a></li><li class="menu-level-2"><a href="services-flysystem.html">Flysystem</a></li><li class="menu-level-2"><a href="services-lang.html">Lang</a></li><li class="menu-level-2"><a href="services-log.html">Log</a></li><li class="menu-level-2"><a href="services-mail.html">Mail</a></li><li class="menu-level-2"><a href="services-mongo.html">Mongo</a></li><li class="menu-level-2"><a href="services-redirect.html">Redirect</a></li><li class="menu-level-2"><a href="services-request.html">Request</a></li><li class="menu-level-2"><a href="services-response.html">Response</a></li><li class="menu-level-2"><a href="services-router.html">Router</a></li><li class="menu-level-2"><a href="services-session.html">Session</a></li><li class="menu-level-2"><a href="services-url.html">URL</a></li><li class="menu-level-2"><a href="services-view.html">View</a></li></ul></li><li class="menu-level-1"><div class="nav-menu-title">Misc.</div><ul class="sidebar-level-2"><li class="menu-level-2"><a href="misc-brood-console.html">Brood Console</a></li><li class="menu-level-2"><div class="nav-menu-title">Database</div><ul class="sidebar-level-3"><li class="menu-level-3"><a href="misc-database-factories.html">Factories</a></li><li class="menu-level-3"><a href="misc-database-migrations.html">Migrations</a></li></ul></li><li class="menu-level-2"><a href="misc-coding-style.html">Coding Style</a></li></ul></li></ul>

        </div>
        <div class="article col-md-9">
            <p>MVC can be metaphorically related to a TV. You have various channels, with different information on them supplied by your cable provider (the model). The TV screen displays these channels to you (the view). <strong>You pressing the buttons on the remote controls affects what you see and how you see it (the controller)</strong>. -<a href="http://stackoverflow.com/questions/2626803/mvc-model-view-controller-can-it-be-explained-in-simple-terms#answer-2626813">Tilo Mitra</a></p>
<h2>Index:</h2>
<ul>
<li><a href="#generate-new-controller">Generate New Controller</a></li>
<li><a href="#basic-routing">Basic Routing</a></li>
<li><a href="#middleware">Middleware</a></li>
</ul>
<p><a name="generate-new-controller"></a></p>
<h1>Generate New Controller</h1>
<p>Run this to your console</p>
<pre><code class="language-shell">php brood app:controller Ticket main
</code></pre>
<p>The above console command creates a <code>TicketController</code> under the <code>main</code> module.</p>
<p>There must be a file located at <code>app/main/controllers/TicketController.php</code></p>
<p><a name="basic-routing"></a></p>
<h1>Basic Routing</h1>
<p>Let us say we&#039;re using a different domain that points to <code>main</code> module, example <code>http://www.flavoredtickets.com</code>, and we want to have a new route, the route file must be located at <code>app/main/routes.php</code></p>
<pre><code class="language-php">Route::addGet(&#039;/new&#039;, [
    &#039;controller&#039; => &#039;Ticket&#039;,
    &#039;action&#039; => &#039;new&#039;,
]);

Route::addPost(&#039;/create&#039;, [
    &#039;controller&#039; => &#039;Ticket&#039;,
    &#039;action&#039; => &#039;create&#039;,
]);

Route::addPost(&#039;/update/{id}&#039;, [
    &#039;controller&#039; -> &#039;Ticket&#039;,
    &#039;action&#039; => &#039;update&#039;,
]);

Route::any(&#039;/delete/{id}&#039;, [
    &#039;controller&#039; => &#039;Ticket&#039;,
    &#039;action&#039; => &#039;delete&#039;,
]);
</code></pre>
<table>
<thead>
<tr><th>Verb          </th><th>URI           </th><th>Desc</th></tr>
</thead>
<tbody>
<tr><td><code>GET</code>       </td><td>/new         </td><td>The <code>TicketController</code> will be instantiated and the function <code>new()</code> will be called</td></tr>
<tr><td><code>POST</code>      </td><td>/new         </td><td>The <code>TicketController</code> will be instantiated and the function <code>create()</code> will be called</td></tr>
<tr><td><code>POST</code>      </td><td>/update/1    </td><td>The <code>TicketController</code> will be instantiated and the function <code>update($id)</code> will be called</td></tr>
<tr><td><code>GET</code> or <code>POST</code>       </td><td>/delete/1    </td><td>The <code>TicketController</code> will be instantiated and the function <code>delete($id)</code> will be called</td></tr>
</tbody>
</table>
<p>The above table shows you how the request and uri processes along the Controller class. <a target="_blank" href="/docs/supporting-structure-routing">To know more about routing, click here.</a></p>
<hr />
<p><a name="middleware"></a></p>
<h1>Middleware</h1>
<pre><code class="language-php"># namespace/use code here

class TicketController extends Controller
{
    public function initialize()
    {
        $this->middleware(&#039;csrf&#039;, [
            &#039;only&#039; => [
                &#039;create&#039;,
            ],
        ]);
    }

    # some functions below
}
</code></pre>
<p>The code above shows how to call a middleware, Phalcon uses <code>__construct()</code> as final function in it, however they added a new function called <code>initialize()</code>, this function was called after the instantiation of the class.</p>
<p>We have a parent function called <code>$this->middleware($alias, $options = [])</code>, the alias is located at <code>project-name/config/app.php</code> under <code>midlewares</code>.</p>
<p>We&#039;re calling <code>&#039;csrf&#039;</code> key, if the dispatched route points to <code>create()</code> function. The class will be called and it is located at <code>project-name/components/Middleware/CSRF.php</code> that has this kind of code:</p>
<pre><code class="language-php">namespace Components\Middleware;

use Clarity\Exceptions\AccessNotAllowedException;

class CSRF implements \League\Tactician\Middleware
{
    public function execute($request, callable $next)
    {
        if ( $request->isPost() ) {

            if ( security()->checkToken() === false ) {

                # - throw exception or redirect the user
                # or render a content using
                # View::take(<resources.view>);exit;

                throw new AccessNotAllowedException(&#039;Token mismatch, what are you doing?&#039;);
            }
        }

        return $next($request);
    }
}
</code></pre>
<p>Can you guess the above code?</p>
<p>It validates your request if it is POST and it validates the csrf token from the form if it is correct, else it will throw an <code>AccessNotAllowedException</code></p>

        </div>
      </div>
    </div>
  </body>

  <script src="../.docs-compiled/assets/js/jquery.js"></script>
  <script src="../.docs-compiled/assets/js/bootstrap.js"></script>
</html>
